# K8sの開発ワークフローを利用する

## Kubernetesにデプロイする

これまでのハンズオンでK8sにデプロイするために`kubectl apply --file name`を実施してきたが、継続的にデプロイするためには次の課題がある。

- いつ誰がコマンドを実施したかわからない
- コマンドの実施により、マニフェストの衝突が起きてしまう
- 毎回手動で実施するのでは、手間がかかる。さらにヒューマンエラーも起きやすい

この課題を解決するためのデプロイ手法として、K8sを利用するケースでは大きく分けてCIOpsとGitOpsがある。いずれもGitHubなど共有リポジトリを利用することでマニフェストの衝突・差分の管理を行なっている。

### Push型のデプロイ方法: CIOps

`kubectl apply --filename <fileName>`を自動化しようとした時に、例えば「mainブランチにfeatureブランチがマージされたら本番環境にkubectl applyを実行する」ようなケースが最初に思いつく。この自動化はCIツールで実行すると思うが、これをCIOpsと呼ぶ。

CIOpsはわかりやすく、かつ実現しやすい手法である。デメリットとしてCI/CD用のツールに強い権限が必要であることや、デプロイ用のスクリプトが長く複雑になりがちということが挙げられる。

### Pull型のデプロイ方法： GitOps

Gitを使っていれば、GitOpsなのでは、と誤解されることも多いが、Gitは直接関係ない。具体的には次の4つの定義に基づいている。

1. 宣言的：システム全体は宣言的に記述される必要がある。
2. バージョン管理と不変：正規望ましいシステムの状態はバージョン管理されている。
3. 自動的に取得：承認された変更はシステムに自動的に適用される
4. 継続的な調整：ソフトウェアエージェントが正確さを保証し、乖離があった場合にアラートを出す。

ここではKubernetesのワークフローを実装するにあたって、大事なポイントを説明する。



